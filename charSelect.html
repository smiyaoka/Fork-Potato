<!doctype html>
<html lang="en"> 
<head>
	<meta charset="utf-8">
	<title>Character Select</title>
    <link type="text/css" rel="stylesheet" href="css/select.css"> 
	 <script src="js/jquery-3.2.1.min.js"></script>
    
    
    <script src="https://www.gstatic.com/firebasejs/3.9.0/firebase.js"></script>
    
    <script>
  // Initialize Firebase
  var config = {
    apiKey: "AIzaSyB8EekPhs6qYLXCxCi0oyypG3f25MlBFFY",
    authDomain: "project-fork-and-potato.firebaseapp.com",
    databaseURL: "https://project-fork-and-potato.firebaseio.com",
    projectId: "project-fork-and-potato",
    storageBucket: "project-fork-and-potato.appspot.com",
    messagingSenderId: "119574546255"
  };
  
  firebase.initializeApp(config);
</script>
    
    
</head> 



<body> 
    <div id="headerContainer">
        <a href="menu.html"><button type="button" id="backBtn">Back</button></a>
    </div>
    
    <!-- Character select -------------------------->
    <div id="charSelectCont1">
    <div id="leftContainer"><button type="button" id="leftButton" class="sideBtn" onclick="plusDivs(-1),trackImg(-1)">&lt</button></div> 
        
    <div id="bodyContainer">
        
    <img class="mySlides" id="char0" src="images/placeholder/mom.gif" style="height:100%">
    <img class="mySlides" id="char1" src="images/placeholder/player.gif" style="height:100%">
    <img class="mySlides" id="char2" src="images/placeholder/sis.gif" style="height:100%">
        
    </div>
    <div id="rightContainer"><button type="button" id="rightButton" class="sideBtn" onclick="plusDivs(1),trackImg(1) ">></button>
    </div>
    </div>
    <!-- Level select ---------------------------->
    <div id="charSelectCont2">
    <div id="leftContainerLevel"><button type="button" id="leftButtonLevel" class="sideBtnLevel" onclick="plusDivsLevel(-1),trackImg(-1)">&lt</button></div> 
        
    <div id="bodyContainerLevel">
        
    <img class="mySlidesLevel" id="char0Level" src="images/placeholder/mom.gif" style="height:100%">
    <img class="mySlidesLevel" id="char1Level" src="images/placeholder/player.gif" style="height:100%">
    <img class="mySlidesLevel" id="char2Level" src="images/placeholder/sis.gif" style="height:100%">
        
    </div>
    <div id="rightContainerLevel"><button type="button" id="rightButtonLevel" class="sideBtnLevel" onclick="plusDivs(1),trackImg(1) ">></button>
    </div>
    </div>
    <!-- Start game ---------------------------->
    
        <div id="footerContainer">
        <div class="selectBtn" id="btnSelect">
            <button type="button" id="selectBtn" onclick="clickedLevelButton(1)">Level 1</button>
            <button type="button" id="selectBtn" onclick="update()">Start Game</button>
        </div>
        
    </div>
    
<script>
    
    // The highest level the player has unlocked. 
    var levelsAvailable; 
    
    firebase.auth().onAuthStateChanged(function(user) {
        var user1 = firebase.auth().currentUser;
        if(user1) {
            firebase.database().ref('/users/' 
                + firebase.auth().currentUser.uid).once('value').then(
                    function(snapshot) {
                        // Level code 
                        levelsAvailable = snapshot.val().levelsAvailable; 
                        firebase.database().ref('users/' + firebase.auth().currentUser.uid).update({ 
                            levelNum: "1"
                        });
                    });
        } else {
            goHome();
        }
    });
    
    
	var database = firebase.database();
	//var ref = database.ref('users');
	var charSelected = 0;
			   
			(function() {
	  var mouseTimer;
	  function mouseDown() { 
		  mouseUp();
		  mouseTimer = window.setTimeout(execMouseDown,1000); //set timeout to fire in 2 seconds when the user presses mouse button down
	  }
	  function mouseUp() { 
		  if (mouseTimer) window.clearTimeout(mouseTimer);  //cancel timer when mouse button is released
		  
		  console.log("Mouse out");
	  }
	  function execMouseDown() { 
			
				//console.log("works");
				console.log(firebase.auth().currentUser.uid);
				firebase.database().ref('users/' + firebase.auth().currentUser.uid).update({ easter: "1" });
				
	  }
	  var div = document.getElementById("selectBtn");
	  div.addEventListener("mousedown", mouseDown);
	  document.body.addEventListener("mouseup", mouseUp);  //listen for mouse up event on body, not just the element you originally clicked on
	}());
	


var slideIndex = 1;
var character0 = document.getElementById("char0");
var character1 = document.getElementById("char1");
var character2 = document.getElementById("char2");

showDivs(slideIndex);

function plusDivs(n) {
  showDivs(slideIndex += n);
}

function showDivs(n) {
  var i;
  var x = document.getElementsByClassName("mySlides");
  if (n > x.length) {slideIndex = 1}    
  if (n < 1) {slideIndex = x.length}
  for (i = 0; i < x.length; i++) {
     x[i].style.display = "none";  
  }
  x[slideIndex-1].style.display = "block";  
}

//*******level select slides
    
function showDivsLevel(n) {
  var i;
  var x = document.getElementsByClassName("mySlidesLevel");
  if (n > x.length) {slideIndex = 1}    
  if (n < 1) {slideIndex = x.length}
  for (i = 0; i < x.length; i++) {
     x[i].style.display = "none";  
  }
  x[slideIndex-1].style.display = "block";  
}

//*******end of level select slides

function trackImg(num) {

charSelected += num;
if(charSelected == 3){
charSelected = 0;
}

if(charSelected == -1) {
charSelected = 2;
}


console.log(charSelected);
}

function update() {
    firebase.database().ref('users/' + firebase.auth().currentUser.uid).update({ 
        charNum: charSelected, 
        levelNum: selectedLevel
    });
    window.location.href = "level.html";
}
</script>

<script>
    // Level Select Code 
    
    // The currently selected level. 
    var selectedLevel = 1; 
    
    function clickedLevelButton(mod) {
        selectedLevel += mod; 
        if (selectedLevel > levelsAvailable) {
            selectedLevel = 1; 
        } else if (selectedLevel < 1) {
            selectedLevel = levelsAvailable; 
        }
        
        $("#selectBtn").html("Level " + selectedLevel); 
    }
    
    
</script>

    
</body>

</html>